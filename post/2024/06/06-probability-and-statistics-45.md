# 《概率统计》 day 45

今天是读《概率统计》的逻辑第 45 天，学习 Test of Goodness-of-Fit，有点像多项分布。

它描述总体由 k 种不同类型组成，每种类型的概率 $\vec{p} = (p_1, ..., p_k)$，一次随机采样，汇总各类型数量 $N_1, ..., N_k$，判断是否拒绝 $H_0: \vec{p} = (p_1^0, ..., p_k^0)$。

需要用到统计

$$
Q = \sum_{i=1}^k \frac{(N_i - np_i^0)^2}{np_i^0}
$$

当 n -> ∞，Q 是自由度 k - 1 的 $\chi^2$ 分布。

这种场景还蛮常见的，比如文档显示某个服务有 95% 的正确率，4% 错误 和 1% 未响应。

一段时间后调用 531 次，其中 512 次正确 18 错误,1 次未响应，

||正确|错误|未响应|
|--|--|--|--|
|数量|512|18|1|
|概率|95%|4%|1%|
|np<sub>i</sub><sup>0</sup>|504.45|21.24|5.31|


||数量|概率|np<sub>i</sub><sup>0</sup>|
|--|--|--|--|
|正确|512|90%|504.45|
|错误|18|4%|21.24|
|未响应|1|1%|5.31|


那么

$$
Q = \frac{(512-504.45)^2}{504.45} + \frac{(18-21.24)^2}{21.24} + \frac{(1-5.31)^2}{5.31} = 4.1
$$

Q 是自由度 2 的 $\chi^2$ 分布，$p(Q \ge 4.1) = 0.0427$

这种假设检验有点怪，假设大多是反着来的，经过计算，最后拒绝 $H_0$，但这个方法似乎不是为了拒绝 $H_0$。

它还有种怪用法，检验连续分布，先把连续分布分成几个区间，原则上每个区间概率近似且不能太小。

五等分的标准正态分布，五个区间就是

|区间|概率|
|--|--|
|(-∞, -0.8416]|0.2|
|(-0.8416, -0.2533]|0.2|
|(-0.2533, 0.2533]|0.2|
|(0.2533, 0.8416]|0.2|
|(0.8416, ∞)|0.2|

也可以根据样本值确定区间

|区间|概率|
|--|--|
|(-∞, -0.75)|0.2266|
|(-0.75, -0.25)|0.1747|
|(-0.25, 0.25)|0.1974|
|(0.25, 0.75)|0.1747|
|(0.75, ∞)|0.2266|

接下来的操作就一样了，汇总每个区间的个数，计算 Q。

只是都知道是正态分布，直接用 t test 不好么，还特意拆成小区间，有点脱裤子放屁的感觉。

如果 $p_i$ 不是常量而是函数，比如 $p_1 = \theta^2, p2= 2 \theta(1-\theta), p_3 = (1-\theta)^2$ 也可以算，更复杂一点。

首先用所有的 $p_i$ 用 $\pi_i(\theta)$ 表示，$\theta$ 可以是标量，也可以是矢量，$\theta$ 的维度用 s 表示。上面这个例子 s = 1，如果是正态分布 $p_i = \pi_i(\mu, \sigma^2)$ 那么 s = 2。

然后统计

$$
Q = \sum_{i=1}^k \frac{(N_i - n\pi_i(\hat{\theta}))^2}{n\pi_i(\hat{\theta})}
$$

是自由度 k - 1 - s 的 $\chi^2$ 分布，$\hat{\theta}$ 是

$$
L(\theta) = \binom{n}{N_1, ..., N_k} \prod_{i=1}^{k} [\pi_i(\theta)]^{N_i}
$$

的 MLE

$$
log L (\theta) = log \binom{n}{N_1, ..., N_k} \sum_{i=1}^{k} N_i[\pi_i(\theta)]
$$

MLE $\hat{\theta}$ 是的 $log L (\theta)$ 最大

一维的时候还方便解

$$
\begin{aligned}
log L(\theta) &= N_1 log \theta^2 + N_2 log 2\theta(1-\theta) + N_3 log(1-\theta)^2 + c\\
&=(2N_1 + N_2)log \theta + (2N_3 + N_2) log (1 - \theta) + c
\end{aligned}
$$

求导

$$
\frac{\partial log L(\theta)}{\partial \theta} = \frac{2N_1 + N_2}{\theta} - \frac{2N_3 + N_2}{1-\theta}
$$

导数等于零解出 $\hat{\theta} = (2N_1 + N_2) / 2n$，带入 10 10 4 得到 $\hat{\theta} = 5/8$，后面就一样了。

但是有时候直接计算 $log L (\theta)$ 的 MLE 不容易计算，可以退而求其次，计算 X 的 MLE，这时候

$$
Q' = \sum_{i=1}^k \frac{(N_i - n\pi_i(\hat{\theta}))^2}{n\pi_i(\hat{\theta})}
$$

当 $n -> \infty$ $Q'$ 的 cdf 介于自由度 k - 1 -s 和 k - 1 的 $\chi^2$ 之间。


样本平均数 67.6，样本方差 1

|身高|数量|
|--|--|
|＜ 66|18|
|66 ~ 67.5|177|
|67.5 ~ 68.5|198|
|68.5 ~ 70|102|
|＞ 70|5|

$\hat{\theta} = (67.6, 1)$

$\pi_1(\hat{\theta}) = 0.0548$

$\pi_2(\hat{\theta}) = 0.4054$

$\pi_3(\hat{\theta}) = 0.3557$

$\pi_4(\hat{\theta}) = 0.1759$

$\pi_5(\hat{\theta}) = 0.0082$

$Q' = 11.2$

封面图：Twitter 心臓弱眞君 @xinzoruo