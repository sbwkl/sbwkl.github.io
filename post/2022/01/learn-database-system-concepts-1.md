# 数据库存储和索引

这篇是《数据库系统概念》第 10，11 章的学习笔记，虽然数据库用了很多年，但是除了用法对数据库本身了解不多，以至于和同事吃饭吹牛的时候只能听他们侃侃而谈，我只能在旁边直呼 666。

为了了解数据库的存储首先要了解存储介质，现在比较多的是机械硬盘和固态硬盘，固态硬盘性能好比较贵，机械硬盘反过来。先说机械硬盘，它有一个机械臂组件和若干个盘片，数据都记录在盘片上，机械臂的末端是一个读写头，悬浮在盘片上，当盘片旋转时读写头就能读取到数据。为了方便盘片会划分为磁道（就是一个个同心圆），磁道再被划分成扇区。

![](magnetic-disk-1.jpg)

机械硬盘读取数据分三步

1. 机械臂找到对应的磁道
2. 盘片旋转找到起始地址
3. 盘片旋转读取扇区数据

这三步里第一步最耗时，盘片越大越慢，其次是第二步。这里可以用坐地铁打比方，当想乘坐地铁去一个地方的时候，去地铁站是最费时的，尤其据地铁站很远。然后是等地铁费时，尤其是上一班刚走，一旦坐上了地铁，那么坐三个站还是五个站其实区别不大。

因此为了优化性能，每次读取的时候会把整个扇区都读到内存里，反正费不了多长时间，不读白不读。也因此内存和磁盘之间的数据交换通常按「块」来。

另外操作系统有局部性原理：时间局部性和空间局部性。其中空间局部性说的是，当前被读取到的地址，后续操作高概率读取附近的下一地址。程序员被要求写出局部性高的代码。










